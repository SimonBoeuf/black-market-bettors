%body
  #loading_screen.screen
    .team#teamblue
      .champion.blue_champion#blue0
      .champion.blue_champion#blue1
      .champion.blue_champion#blue2
      .champion.blue_champion#blue3
      .champion.blue_champion#blue4
    #vs VERSUS
    .team#teamred
      .champion.red_champion#red5
      .champion.red_champion#red6
      .champion.red_champion#red7
      .champion.red_champion#red8
      .champion.red_champion#red9
  #game_screen.screen
    .side#blue
      .team_side#blue_team
        .team_summary#blue_team_summary
          .team_summary_towers#blue_team_summary_towers
          .team_summary_gold#blue_team_summary_gold
          .team_summary_drakes#blue_team_summary_drakes
          .team_summary_barons#blue_team_summary_barons
          .team_summary_score#blue_team_summary_score
        .participants_summary#blue_team_participants_summary
          .participant_summary#participant_summary_1
            .participant_summary_champion.line1#participant_summary_champion_1
            .participant_summary_level.line1#participant_summary_level_1
            .participant_summary_kda.line1#participant_summary_kda_1
            .participant_summary_brawler.line1#participant_summary_brawler_1
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_1
            .participant_summary_items#participant_summary_items_1
              .participant_summary_item#participant_summary_item_1_1
              .participant_summary_item#participant_summary_item_2_1
              .participant_summary_item#participant_summary_item_3_1
              .participant_summary_item#participant_summary_item_4_1
              .participant_summary_item#participant_summary_item_5_1
              .participant_summary_item#participant_summary_item_6_1
          .participant_summary#participant_summary_2
            .participant_summary_champion.line1#participant_summary_champion_2
            .participant_summary_level.line1#participant_summary_level_2
            .participant_summary_kda.line1#participant_summary_kda_2
            .participant_summary_brawler.line1#participant_summary_brawler_2
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_2
            .participant_summary_items#participant_summary_items_2
              .participant_summary_item#participant_summary_item_1_2
              .participant_summary_item#participant_summary_item_2_2
              .participant_summary_item#participant_summary_item_3_2
              .participant_summary_item#participant_summary_item_4_2
              .participant_summary_item#participant_summary_item_5_2
              .participant_summary_item#participant_summary_item_6_2
          .participant_summary#participant_summary_3
            .participant_summary_champion.line1#participant_summary_champion_3
            .participant_summary_level.line1#participant_summary_level_3
            .participant_summary_kda.line1#participant_summary_kda_3
            .participant_summary_brawler.line1#participant_summary_brawler_3
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_3
            .participant_summary_items#participant_summary_items_3
              .participant_summary_item#participant_summary_item_1_3
              .participant_summary_item#participant_summary_item_2_3
              .participant_summary_item#participant_summary_item_3_3
              .participant_summary_item#participant_summary_item_4_3
              .participant_summary_item#participant_summary_item_5_3
              .participant_summary_item#participant_summary_item_6_3
          .participant_summary#participant_summary_4
            .participant_summary_champion.line1#participant_summary_champion_4
            .participant_summary_level.line1#participant_summary_level_4
            .participant_summary_kda.line1#participant_summary_kda_4
            .participant_summary_brawler.line1#participant_summary_brawler_4
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_4
            .participant_summary_items#participant_summary_items_4
              .participant_summary_item#participant_summary_item_1_4
              .participant_summary_item#participant_summary_item_2_4
              .participant_summary_item#participant_summary_item_3_4
              .participant_summary_item#participant_summary_item_4_4
              .participant_summary_item#participant_summary_item_5_4
              .participant_summary_item#participant_summary_item_6_4
          .participant_summary#participant_summary_5
            .participant_summary_champion.line1#participant_summary_champion_5
            .participant_summary_level.line1#participant_summary_level_5
            .participant_summary_kda.line1#participant_summary_kda_5
            .participant_summary_brawler.line1#participant_summary_brawler_5
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_5
            .participant_summary_items#participant_summary_items_5
              .participant_summary_item#participant_summary_item_1_5
              .participant_summary_item#participant_summary_item_2_5
              .participant_summary_item#participant_summary_item_3_5
              .participant_summary_item#participant_summary_item_4_5
              .participant_summary_item#participant_summary_item_5_5
              .participant_summary_item#participant_summary_item_6_5
    .side#red
      .team_side#red_team
        .team_summary#red_team_summary
          .team_summary_towers#red_team_summary_towers
          .team_summary_gold#red_team_summary_gold
          .team_summary_drakes#red_team_summary_drakes
          .team_summary_barons#red_team_summary_barons
          .team_summary_score#red_team_summary_score
        .participants_summary#red_team_participants_summary
          .participant_summary#participant_summary_6
            .participant_summary_champion.line1#participant_summary_champion_6
            .participant_summary_level.line1#participant_summary_level_6
            .participant_summary_kda.line1#participant_summary_kda_6
            .participant_summary_brawler.line1#participant_summary_brawler_6
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_6
            .participant_summary_items#participant_summary_items_6
              .participant_summary_item#participant_summary_item_1_6
              .participant_summary_item#participant_summary_item_2_6
              .participant_summary_item#participant_summary_item_3_6
              .participant_summary_item#participant_summary_item_4_6
              .participant_summary_item#participant_summary_item_5_6
              .participant_summary_item#participant_summary_item_6_6
          .participant_summary#participant_summary_7
            .participant_summary_champion.line1#participant_summary_champion_7
            .participant_summary_level.line1#participant_summary_level_7
            .participant_summary_kda.line1#participant_summary_kda_7
            .participant_summary_brawler.line1#participant_summary_brawler_7
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_7
            .participant_summary_items#participant_summary_items_7
              .participant_summary_item#participant_summary_item_1_7
              .participant_summary_item#participant_summary_item_2_7
              .participant_summary_item#participant_summary_item_3_7
              .participant_summary_item#participant_summary_item_4_7
              .participant_summary_item#participant_summary_item_5_7
              .participant_summary_item#participant_summary_item_6_7
          .participant_summary#participant_summary_8
            .participant_summary_champion.line1#participant_summary_champion_8
            .participant_summary_level.line1#participant_summary_level_8
            .participant_summary_kda.line1#participant_summary_kda_8
            .participant_summary_brawler.line1#participant_summary_brawler_8
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_8
            .participant_summary_items#participant_summary_items_8
              .participant_summary_item#participant_summary_item_1_8
              .participant_summary_item#participant_summary_item_2_8
              .participant_summary_item#participant_summary_item_3_8
              .participant_summary_item#participant_summary_item_4_8
              .participant_summary_item#participant_summary_item_5_8
              .participant_summary_item#participant_summary_item_6_8
          .participant_summary#participant_summary_9
            .participant_summary_champion.line1#participant_summary_champion_9
            .participant_summary_level.line1#participant_summary_level_9
            .participant_summary_kda.line1#participant_summary_kda_9
            .participant_summary_brawler.line1#participant_summary_brawler_9
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_9
            .participant_summary_items#participant_summary_items_9
              .participant_summary_item#participant_summary_item_1_9
              .participant_summary_item#participant_summary_item_2_9
              .participant_summary_item#participant_summary_item_3_9
              .participant_summary_item#participant_summary_item_4_9
              .participant_summary_item#participant_summary_item_5_9
              .participant_summary_item#participant_summary_item_6_9
          .participant_summary#participant_summary_10
            .participant_summary_champion.line1#participant_summary_champion_10
            .participant_summary_level.line1#participant_summary_level_10
            .participant_summary_kda.line1#participant_summary_kda_10
            .participant_summary_brawler.line1#participant_summary_brawler_10
            .participant_summary_brawler_upgrade.line1#participant_summary_brawler_upgrade_10
            .participant_summary_items#participant_summary_items_10
              .participant_summary_item#participant_summary_item_1_10
              .participant_summary_item#participant_summary_item_2_10
              .participant_summary_item#participant_summary_item_3_10
              .participant_summary_item#participant_summary_item_4_10
              .participant_summary_item#participant_summary_item_5_10
              .participant_summary_item#participant_summary_item_6_10

    #map
  #winner_screen.screen
    WINNER !
:javascript
  var participants_items = [[],[],[],[],[],[],[],[],[],[],[]];
  $(document).ready(function() {

    var dispatcher = new WebSocketRails("#{request.host_with_port}/websocket");
    dispatcher.on_open = function (data) {
        console.log('GL & HF !', data);
    };

    dispatcher.bind('status_msg', function(ws) {
      switch(ws.status) {
        case "loading":
          // Loading scree infos
          launch_loading_screen(ws.data);
          break;
        case "running":
          // Game state
          launch_game_screen(ws.data);
          break;
        case "ended":
          // Winning team
          launch_winner_screen(ws.data);
          break;
      };
    });

    dispatcher.bind('event_msg', function(ws) {
      ws.type == 'event' ? process_event(ws.data) : process_frame(ws.data);
    });

    var unloadEvent = window.attachEvent || window.addEventListener;
    var chkevent = window.attachEvent ? 'onbeforeunload' : 'beforeunload';

    unloadEvent(chkevent, function(e) {
      dispatcher.disconnect();
    });
  });

  function launch_loading_screen(data){
    $(".screen").hide();
    $('#loading_screen').fadeIn(1000);
    $.each(data, function(index, champion){
      $("#" + team_side(index + 1) + index.toString()).html("<img src=\"" + get_loading_champion_image_url(champion.image) + "\"/>");
    });
  };

  function launch_game_screen(data){
    $(".screen").hide();
    $("#game_screen").fadeIn(1000);
    build_game(data);
  };

  function launch_winner_screen(data){
    $(".screen").hide();
    $("#winning_screen").fadeIn(1000);
  };

  function build_game(data){
    participants_items = [[],[],[],[],[],[],[],[],[],[],[]];
    build_team("blue", data.blue_team);
    build_team("red", data.red_team);
  };

  function build_team(side, data){
    build_team_summary(side, data);
    build_participants_summary(data.participants);
  };

  function build_team_summary(side, data){
    $("#"+side+"_team_summary_towers").text(data.tower_kills.toString());
    $("#"+side+"_team_summary_gold").text(data.gold.toString());
    $("#"+side+"_team_summary_drakes").text(data.drakes.toString());
    $("#"+side+"_team_summary_barons").text(data.barons.toString());
    $("#"+side+"_team_summary_score").text(data.total_kills.toString());
  }

  function build_participants_summary(data){
    $.each(data, function(i, participant)
    {
      build_participant(participant)
    });
  };

  function build_participant(participant)
  {
    get_sprite($("#participant_summary_champion_" + participant.participantId), participant.champion.image);
    $("#participant_summary_level_" + participant.participantId).html(participant.level.toString() == 0 ? "1&nbsp;" : participant.level.toString());
    $("#participant_summary_kda_"+participant.participantId).html("<span class=\"kills\">" + participant.kills.toString() + "Kda : </span> / " + "<span class=\"deaths\">" + participant.deaths.toString() + "</span> / <span class=\"assists\">" + participant.assists.toString() + "</span>");
    if (participant.brawler.type != null){get_sprite($("#participant_summary_brawler_" + participant.participantId), participant.brawler.type.image);};
    if (participant.brawler.evolve != null){get_sprite($("#participant_summary_brawler_upgrade_" + participant.participantId), participant.brawler.evolve.image);};
    build_participant_item_set($("#participant_summary_items_" + participant.participantId),participant.items, participants_items[participant.participantId]);
  };

  function get_sprite(jquery_div, image)
  {
    jquery_div.attr("style",get_sprite_style(image));
  };

  function build_participant_item_set(jquery_div, item_set, stuff)
  {
    $.each(item_set, function(index, item){
      stuff.push(item);
    });
    display_item_set(stuff, jquery_div)
  };

  function display_item_set(stuff, jquery_div){
    $.each(jquery_div.children("div"), function(index, div){
      if (typeof(stuff[index]) !== "undefined"){
        get_sprite($(div), stuff[index].image);
      }
      else
      {
        $(div).attr("style", "");
      }
    });
  };

  function get_loading_champion_image_url(img){
    return "#{RiotApi::Static_Data.get_realm({region: 'euw'})['cdn']}/img/" + img.group + "/loading/" + img.full.slice(0, -4) + "_0.jpg"
  };

  function get_sprite_style(img){
    return "width:" + img.w + "px;height:" + img.h + "px;background: url(#{StaticData.get_base_dragon_url("euw")}/img/sprite/" + img.sprite + "); background-repeat:no-repeat;background-position:-" + img.x + "px -" + img.y + "px;";
  }

  function process_event(data) {
    switch(data.eventType){
      case "BUILDING_KILL" :
        process_building_kill(data);
        break;
      case "CHAMPION_KILL" :
        process_champion_kill(data);
        break;
      case "ELITE_MONSTER_KILL" :
        process_elite_monster_kill(data);
        break;
      case "ITEM_DESTROYED" :
        process_item_remove(data);
        break;
      case "ITEM_SOLD" :
        process_item_remove(data);
        break;
      case "ITEM_UNDO" :
        process_item_remove(data);
        break;
      case "ITEM_PURCHASED" :
        process_item_add(data);
        break;
      case "SKILL_LEVEL_UP" :
        process_skill_level_up(data);
        break;
    };
  };

  function process_item_remove(event){
    if (!event.is_brawler && !event.is_brawler_upgrade)
    {
      stuff = participants_items[event.participant.participantId];
      index = -1;
      $.each(stuff, function(i, item){
        if (item.id == event.item.id){
          index = i;
          return(false);
        }
      });
      if (index == -1){
        console.log("Not found : " + event.item.name);
        if (!event.item)
          console.log(event);
      }
      else{
        stuff.splice(index, 1);
      };
      display_item_set(stuff, $("#participant_summary_items_" + event.participant.participantId));
    }
  };

  function process_item_add(event){
    if (event.is_brawler)
      get_sprite($("#participant_summary_brawler_" + event.participant.participantId), event.item.image);
    else if (event.is_brawler_upgrade)
      get_sprite($("#participant_summary_brawler_upgrade_" + event.participant.participantId), event.item.image);
    else
    {
      participants_items[event.participant.participantId].push(event.item)
      display_item_set(participants_items[event.participant.participantId], $("#participant_summary_items_" + event.participant.participantId));
    };
  };

  function process_frame(frame){
    if (frame)
    {
      $("#blue_team_summary_gold").text(frame.blue_team_gold);
      $("#red_team_summary_gold").text(frame.red_team_gold);
    }
  };

  function process_building_kill(event){
    if (event.buildingType == "TOWER_BUILDING")
      process_tower_kill(event);
    if (event.buildingType == "INHIBITOR_BUILDING")
      process_inhibitor_kill(event);
  };

  function process_inhibitor_kill(event){
  };

  function process_tower_kill(event){
    event.teamId == 200 ? $("#blue_team_summary_towers").text(1 + parseInt($("#blue_team_summary_towers").text())) : $("#red_team_summary_towers").text(1 + parseInt($("#red_team_summary_towers").text()));
  };

  function process_champion_kill(event){
    $("#participant_summary_kda_" + event.killerId).find("span.kills").text(parseInt($("#participant_summary_kda_" + event.killerId).find("span.kills").text()) + 1);
    $("#participant_summary_kda_" + event.victimId).find("span.deaths").text(parseInt($("#participant_summary_kda_" + event.victimId).find("span.deaths").text()) + 1);
    $.each(event.assisting_participants, function(i, p){
      $("#participant_summary_kda_" + p.participantId).find("span.assists").text(parseInt($("#participant_summary_kda_" + p.participantId).find("span.assists").text()) + 1);
    });
    $("#" + team_side(event.killerId) + "_team_summary_score").text(parseInt($("#" + team_side(event.killerId) + "_team_summary_score").text()) + 1)
    //TODO : animation minimap + transition div
  };

  function process_elite_monster_kill(event){
    if (event.monsterType == "DRAGON")
      $("#" + team_side(event.killerId) + "_team_summary_drakes").text(parseInt($("#" + team_side(event.killerId) + "_team_summary_drakes").text()) + 1)
    else
      $("#" + team_side(event.killerId) + "_team_summary_barons").text(parseInt($("#" + team_side(event.killerId) + "_team_summary_barons").text()) + 1)
  };

  function  process_skill_level_up(event){
    div = $("#participant_summary_level_" + event.participant.participantId)
    if (div.html() == "1&nbsp;"){
      div.text("1");
    }
    else{
      div.text(parseInt(div.text()) + 1);
    }

  };

  function team_side(participantId){
    return (participantId < 6 ? "blue" : "red");
  };

